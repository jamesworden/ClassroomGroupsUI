<div
  class="w-full h-full flex"
  [ngClass]="{
    'select-none': isResizing()
  }"
>
  <app-sidebar
    (toggledClassAndConfigPanel)="toggleClassAndConfigPanel()"
  ></app-sidebar>

  <div class="flex-1 w-full h-full flex">
    @if (classAndConfigPanelSettings().isOpen) {
    <div
      appResizeable
      [resizableSides]="[ResizableSide.RIGHT]"
      [panelWidth]="classAndConfigPanelSettings().width"
      [maxWidth]="maxClassAndConfigPanelWidth"
      [minWidth]="minClassAndConfigPanelWidth"
      (resizedWidth)="setPanelWidth($event)"
      [ngStyle]="{
        'min-width': classAndConfigPanelSettings().width + 'px'
      }"
      class="flex flex-col border-r border-neutral-400 shadow-lg"
      resizingId="classrooms-and-config-panel"
    >
      <app-classrooms-panel class="flex-1"></app-classrooms-panel>
      <app-configurations-panel
        appResizeable
        [resizableSides]="[ResizableSide.TOP]"
        [panelHeight]="configPanelSettings().height"
        [maxHeight]="maxConfigurationsPanelHeight"
        [minHeight]="minConfigurationsPanelHeight"
        [maxWidth]="maxClassAndConfigPanelWidth"
        [minWidth]="minClassAndConfigPanelWidth"
        (resizedHeight)="setConfigPanelHeight($event)"
        [ngStyle]="{
          'min-height': configPanelSettings().height + 'px'
        }"
        class="border-t border-neutral-400"
        resizingId="config-panel"
      ></app-configurations-panel>
    </div>
    }

    <div class="flex flex-col flex-1 overflow-auto">
      <div class="my-4 flex-1 flex flex-col">
        <section class="flex justify-between m-4">
          <div class="flex flex-col flex-1">
            <input
              class="text-ellipsis text-3xl m-0 appearance-none bg-transparent rounded border border-transparent hover-border-primary px-2 leading-tight focus:outline-none focus:shadow-outline"
              type="text"
              maxlength="150"
              [(ngModel)]="updatedClassroomLabel"
              (change)="updateClassroomLabel()"
            />
            <input
              class="text-ellipsis appearance-none bg-transparent rounded border border-transparent hover-border-primary px-2 leading-tight focus:outline-none focus:shadow-outline"
              type="text"
              maxlength="150"
              [(ngModel)]="updatedClassroomDescription"
              (change)="updateClassroomDescription()"
              placeholder="Add a description for your classroom"
            />
          </div>

          <div>
            <button mat-icon-button [matMenuTriggerFor]="classroomSettingsMenu">
              <mat-icon>settings</mat-icon>
            </button>
          </div>
        </section>

        <div class="flex flex-col gap-y-6 flex-1">
          <section class="sticky top-0 mx-4 z-10">
            <app-configuration-panel></app-configuration-panel>
          </section>

          @if(editingGroups.length === 0) {
          <section
            class="mx-4 border border-4 border-dashed border-gray-300 flex-1 flex flex-col justify-around"
          >
            <div class="flex flex-col" [ngClass]="{
              'gap-y-4': !isLoggedIn()
            }">
              <div class="flex flex-col gap-y-1">
                <div class="flex justify-around">
                  <h5 class="opacity-50" style="margin: 0">
                    Drag spreadsheet here
                  </h5>
                </div>

                <div class="flex justify-around">
                  <span class="opacity-50">Or if you prefer...</span>
                </div>
              </div>

              <div class="flex flex-col gap-y-2">
                <div class="flex justify-around">
                  @if (!isLoggedIn()) {
                    <div>
                      <div
                        id="g_id_onload"
                        data-client_id="379282615975-blkaldtgv9vuieo7hc2gmttkl2nb5983.apps.googleusercontent.com"
                        data-context="signin"
                        data-ux_mode="popup"
                        data-login_uri="https://localhost:7192/classroom-groups/api/v1/authentication/login-with-google"
                        data-redirecturi="https://localhost:4200/"
                        data-auto_prompt="false"
                      ></div>
                      <div
                        class="g_id_signin"
                        data-type="standard"
                        data-shape="rectangular"
                        data-theme="outline"
                        data-text="signin_with"
                        data-size="large"
                        data-logo_alignment="left"
                      ></div>
                    </div>
                  }
                </div>

                <div class="flex justify-around">
                  <div class="flex gap-x-2">
                    <div class="flex justify-around">
                      <button
                        class="max-h-8 text-sm"
                        mat-button
                        (click)="createGroup()"
                      >
                        Create a new group
                      </button>
                    </div>

                    <div class="flex justify-around">
                      <button
                        class="max-h-8 text-sm"
                        appearance="outline"
                        mat-button
                        (click)="chooseFileToUpload()"
                      >
                        Choose file to upload
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
          } @else {
          <section
            cdkDropList
            (cdkDropListDropped)="drop($event)"
            class="mx-4 flex flex-col flex-1 gap-y-6"
          >
            @for(group of editingGroups; track group.id) {
            <app-group-panel cdkDrag [group]="group">
              <mat-icon class="cursor-move" cdkDragHandle>drag_handle</mat-icon>
            </app-group-panel>

            }
          </section>
          }
        </div>
      </div>
    </div>
  </div>
</div>

<mat-menu #classroomSettingsMenu="matMenu">
  <button
    mat-menu-item
    [disabled]="classrooms().length <= 1"
    [matTooltip]="
      classrooms().length <= 1 ? 'You can\'t delete the last classroom' : ''
    "
    (click)="openDeleteClassroomDialog()"
  >
    <mat-icon>delete</mat-icon>
    <span>Delete classroom</span>
  </button>
</mat-menu>
