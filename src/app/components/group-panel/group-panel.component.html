<div class="panel rounded-lg flex-col gap-y-2 p-2 shadow-lg">
  <div class="flex justify-between">
    <div class="flex gap-x-2 flex-1">
      <div class="flex flex-col justify-around">
        <ng-content></ng-content>
      </div>

      <div class="flex flex-col justify-around flex-1 mr-2">
        <input
          class="text-ellipsis text-2xl m-0 appearance-none bg-transparent rounded border border-transparent hover-border-primary px-2 leading-tight focus:outline-none focus:shadow-outline"
          type="text"
          maxlength="120"
          [value]="groupDetail()?.label || ''"
          (change)="updateLabel($event)"
          placeholder="Untitled"
        />
      </div>
    </div>

    <div class="flex gap-x-2">
      <button mat-icon-button (click)="createStudent()">
        <mat-icon>person_add</mat-icon>
      </button>

      <div
        [matTooltip]="
          studentsInGroup().length > 0
            ? 'You can\'t delete group that contains students'
            : ''
        "
      >
        <button
          mat-icon-button
          (click)="deleteGroup()"
          [disabled]="studentsInGroup().length > 0"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <div
    cdkDropList
    [id]="groupDetail()?.id ?? ''"
    [cdkDropListConnectedTo]="groupIdsWithUngroupedId()"
    class="grid-row student-list rounded-md overflow-hidden w-full mt-2"
    [ngClass]="{
      'min-h-12 border-4 border-dashed border-gray-300':
        editingStudents.length <= 0
    }"
    (cdkDropListDropped)="drop($event)"
  >
    @for (student of editingStudents; track student.id) {
    <div
      class="grid-row student-row text-sm cursor-move flex border-b border-neutral-200 dark:border-neutral-600 p-2 flex"
      cdkDrag
    >
      @for(columnDetail of columnDetails(); track i; let i = $index) {
      <div class="flex-1">
        <div>
          @if(editingFieldId === columnDetail.fieldId && editingStudentId ===
          student.id) {
          <input
            #valueInput
            type="text"
            [(ngModel)]="editingField"
            placeholder="Add value"
            class="outline-none bg-transparent border-none w-full text-ellipsis"
            (change)="saveEdits()"
          />
          } @else {
          <span
            class="cursor-text"
            [ngClass]="{
              'opacity-50':
                student.fieldIdsToValues[columnDetail.fieldId] === undefined ||
                student.fieldIdsToValues[columnDetail.fieldId] === ''
            }"
            (click)="
              startEditing(
                columnDetail.fieldId,
                student.fieldIdsToValues[columnDetail.fieldId],
                student.id
              )
            "
          >
            {{ student.fieldIdsToValues[columnDetail.fieldId] || 'Add value' }}
          </span>
          }
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>
